title: 破解安卓机nfc功能模拟卡限制
date: 2020-07-19 21:09:16
tags: nfc
categories: 手机

---

{%note info%}
本文记录使用`PN532`破解手机厂商对收集nfc功能的限制。
{%endnote%}
<!--more-->

## 背景

- 一般安卓旗舰都带有nfc功能，但是简单的使用门卡功能复制了两张卡片，缺无法使用，本文记录使用`PN532`破解手机厂商对收集nfc功能的限制

## 准备材料

- 带nfc功能的`安卓`手机（iphone没试过）
- `PN532`nfc加解密工具（TB购买）
- 一张CUID卡，用于克隆卡数据
- 一台Windows上位机，用于安装PN532驱动
- 破解卡类型只针对`半加密卡`

## 操作步骤

1. 判断待模拟卡是否为半加密卡
    - 手机安装`MIFARE Classic Tool`工具，通过`读标签`读取实体卡片数据
      ![WechatIMG26.jpeg](https://i.loli.net/2020/07/18/pJk3hv4cu6MOsRD.jpg) 
    
      
    
    - 半解密卡数据格式如下
    ![20200718221445.jpg](https://i.loli.net/2020/07/18/jUFSKEIyl9hXxLt.jpg)
2. 安装PN532上位机驱动（软件操作大同小异，就不贴图了）
3. 使用PN532破解，并读取实体卡数据
    
    - 将原卡放在PN532上，点击“一键破解”，大概5s后窗口显示破解数据（读出数据后，可以选择保存文件，记住该文件名）
4. 使用CUID卡克隆实体卡
    
    - 将CUID卡放在PN532上，点击“写CUID卡”（因为此时步骤3暂存着实体卡的解密数据），等待CUID卡写入完成，使用该CUID卡去刷门禁，成功则说明克隆完成
5. 格式化CUID，使其只保留0扇区数据
    
    - 将CUID卡放在PN532上，点击“格式化卡”，这样CUID即成了实体卡的同号空卡
6. 手机模拟CUID卡数据（即实体卡的同号空卡）
    - （以小米手机为例）小米钱包-==门卡==-模拟实体门卡，讲CUID卡在上手机背面，并完成对应操作
    ![301595081317_.pic.jpg](https://i.loli.net/2020/07/18/WmZw7TpEuzBDJqL.jpg)
7. 通过PN532像手机模拟的同号空卡中写入其他扇区加密数据
    
    - 讲手机放在PN532上，导入步骤1保存的数据，点击“写普通M1卡”，写入成功加密数据，不出意外，手机上的模拟卡已可以正常使用

- 异常情况
    - 确认步骤如下，若模拟卡无法使用，则导出模拟卡数据至CUID卡，若CUID卡可以使用，则说明该设备不支持识别模拟卡（一些设备，如家庭门禁不识别模拟卡，暂时无解）
    
    - 若CUID卡也无法使用，则说明整体操作存在问题，需仔细阅读操作步骤，并也可以到处模拟卡数据，通过dump数据比对工具和原实体卡导出数据比对，若0扇区前8位数据不一致，则说明没有模拟成功，后8位为厂商识别码，不一致是正常的
    
    - 异常情况的`银弹`是使用卡贴（选择CUID卡功能的卡贴）
    
      
## 扫盲

- 芯片分类
  - 8268卡也叫ID防火墙卡
  - 手机nfc能模拟的是IC卡

![281595081315_.pic.jpg](https://i.loli.net/2020/07/18/tXbNPakwWYyfOeV.jpg)

- IC卡与ID卡

  [![271595081314_.pic.jpg](https://i.loli.net/2020/07/19/WeODnArb1QuRMIy.jpg)](https://i.loli.net/2020/07/19/WeODnArb1QuRMIy.jpg)

